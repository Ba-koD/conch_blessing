---
name: Conch’s Blessing — Architecture & File Map
---

## Architecture overview

### Entry and boot
```1:3:main.lua
-- Conch's Blessing - Loader
require("scripts/conch_blessing_core")
-----------------------------------------------------------
```

```6:13:scripts/conch_blessing_core.lua
local mod = RegisterMod("Conch's Blessing", 1)
ConchBlessing = isc:upgradeMod(mod, {
    isc.ISCFeature.PLAYER_INVENTORY,
    isc.ISCFeature.ROOM_HISTORY,
    isc.ISCFeature.GRID_ENTITY_COLLISION_DETECTION,
})
-- ConchBlessing now contains the upgraded mod, but mod variable keeps the original RegisterMod reference
ConchBlessing.originalMod = mod
```

- Roles
  - `main.lua`: Entry point; loads core only.
  - `scripts/conch_blessing_core.lua`:
    - Mod registration and `isaacscript-common` upgrade
    - SaveManager initialization and global exposure
    - Config init and MCM setup
    - Run start reset (stats, unified multipliers, run-scoped data)
    - Loads stats/items/callback manager/upgrade system and initializes stats display

```55:67:scripts/conch_blessing_core.lua
mod:AddCallback(ModCallbacks.MC_POST_GAME_STARTED, function(_, isContinued)
    Isaac.ConsoleOutput("[Core] Game started, trying to load MCM config\n")
    
    -- Reset multiplier display data for new game
    if ConchBlessing.stats and ConchBlessing.stats.multiplierDisplay then
        Isaac.ConsoleOutput("[Core] Resetting multiplier display data\n")
        ConchBlessing.stats.multiplierDisplay:ResetForNewGame()
    end
    
    -- Reset unified multiplier system for new game
    if ConchBlessing.stats and ConchBlessing.stats.unifiedMultipliers then
        Isaac.ConsoleOutput("[Core] Resetting unified multiplier system\n")
```

### Content and resources
- `content/items.xml`, `content/itempools.xml`, `content/entities2.xml` - generated by generate_xml.py
- `resources/gfx/**` sprites/anm2, `metadata.xml` workshop metadata

---

## Quick file role map

- Core
  - `main.lua`: entry
  - `scripts/conch_blessing_core.lua`: registration/init/run-start reset/loader
- Systems
  - `scripts/conch_blessing_items.lua`: item meta/registration/callback wiring
  - `scripts/callback_manager.lua`: callback mapping/registration
  - `scripts/lib/stats.lua`: multipliers/additions/cache/display
  - `scripts/lib/save_manager.lua`: save system
  - `scripts/template.lua`: upgrade visuals
- Config/MCM
  - `scripts/conch_blessing_config.lua`: settings/language/save
  - `scripts/conch_blessing_mcm.lua`: MCM UI/settings save-load
- Items
  - `scripts/items/...`: each item/trinket/familiar module
- Content/Resources
  - `content/*.xml`: items/pools/entities
  - `resources/gfx/**`: sprites/anm2

